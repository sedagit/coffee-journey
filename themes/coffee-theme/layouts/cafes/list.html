{{ define "main" }}

<section class="cafes-list-page">
    <div class="container">
        <header class="page-header">
            <h1>æ‰€æœ‰å’–å•¡åº—</h1>
            <p>æ¢ç´¢ {{ len .Pages }} å®¶ç²¾å¿ƒé€ è¨ªçš„å’–å•¡åº—</p>
        </header>
        
        {{- /* Filter Bar */ -}}
        <div class="filter-bar">
            <div class="filter-group">
                <label>åœ°å€:</label>
                <select id="region-filter">
                    <option value="">å…¨éƒ¨åœ°å€</option>
                    {{ range .Site.Taxonomies.regions }}
                    <option value="{{ .Page.Title }}">{{ .Page.Title }} ({{ .Count }})</option>
                    {{ end }}
                </select>
            </div>
            
            <div class="filter-group">
                <label>é¢¨æ ¼:</label>
                <select id="style-filter">
                    <option value="">å…¨éƒ¨é¢¨æ ¼</option>
                    {{ range .Site.Taxonomies.styles }}
                    <option value="{{ .Page.Title }}">{{ .Page.Title }} ({{ .Count }})</option>
                    {{ end }}
                </select>
            </div>
            
            <div class="filter-group">
                <label>åƒ¹æ ¼:</label>
                <select id="price-filter">
                    <option value="">å…¨éƒ¨åƒ¹æ ¼</option>
                    <option value="$">$ ç¶“æ¿Ÿå¯¦æƒ </option>
                    <option value="$$">$$ ä¸­ç­‰åƒ¹ä½</option>
                    <option value="$$$">$$$ ç¨é«˜åƒ¹ä½</option>
                    <option value="$$$$">$$$$ é«˜åƒ¹ä½</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label>æ’åº:</label>
                <select id="sort-filter">
                    <option value="date-desc">æœ€æ–°é€ è¨ª</option>
                    <option value="date-asc">æœ€æ—©é€ è¨ª</option>
                    <option value="rating-desc">è©•åˆ†é«˜åˆ°ä½</option>
                    <option value="rating-asc">è©•åˆ†ä½åˆ°é«˜</option>
                </select>
            </div>
        </div>
        
        {{- /* Cafes Grid */ -}}
        <div class="cafes-grid" id="cafes-grid">
            {{ range .Pages }}
            <article class="cafe-card" 
                     data-region="{{ if .Params.regions }}{{ index .Params.regions 0 }}{{ end }}"
                     data-style="{{ if .Params.styles }}{{ .Params.styles }}{{ end }}"
                     data-price="{{ if .Params.price_range }}{{ .Params.price_range }}{{ end }}"
                     data-rating="{{ if .Params.rating }}{{ .Params.rating }}{{ else }}0{{ end }}"
                     data-date="{{ .Date.Format "2006-01-02" }}">
                <a href="{{ .Permalink }}">
                    {{ if .Params.featured_image }}
                    <div class="cafe-image">
                        <img src="{{ .Params.featured_image }}" alt="{{ .Title }}" loading="lazy">
                        {{ if .Params.rating }}
                        <div class="cafe-rating">
                            <span class="stars">{{ partial "star-rating.html" .Params.rating }}</span>
                        </div>
                        {{ end }}
                    </div>
                    {{ else }}
                    <div class="cafe-image placeholder">
                        <span>â˜•</span>
                    </div>
                    {{ end }}
                    
                    <div class="cafe-content">
                        <h3>{{ .Title }}</h3>
                        
                        <div class="cafe-meta">
                            {{ if .Params.regions }}
                            <span class="region">ğŸ“ {{ index .Params.regions 0 }}</span>
                            {{ end }}
                            {{ if .Params.price_range }}
                            <span class="price">{{ .Params.price_range }}</span>
                            {{ end }}
                        </div>
                        
                        {{ if .Summary }}
                        <p class="cafe-excerpt">{{ .Summary | truncate 100 }}</p>
                        {{ end }}
                        
                        {{ if .Params.tags }}
                        <div class="cafe-tags">
                            {{ range first 3 .Params.tags }}
                            <span class="tag">#{{ . }}</span>
                            {{ end }}
                        </div>
                        {{ end }}
                        
                        <div class="cafe-date">
                            {{ .Date.Format "2006å¹´01æœˆ02æ—¥" }}
                        </div>
                    </div>
                </a>
            </article>
            {{ end }}
        </div>
        
        <div id="no-results" class="no-results" style="display: none;">
            <p>ğŸ˜¢ æ‰¾ä¸åˆ°ç¬¦åˆæ¢ä»¶çš„å’–å•¡åº—</p>
            <button onclick="resetFilters()" class="btn-secondary">é‡ç½®ç¯©é¸</button>
        </div>
    </div>
</section>

{{ end }}
